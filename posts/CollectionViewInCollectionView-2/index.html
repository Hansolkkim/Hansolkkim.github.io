<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="CollectionView 안에 CollectionView 넣기 - (2)" /><meta property="og:locale" content="ko" /><meta name="description" content="(앞서 작성했던 1편에 이어 작성되었습니다.)" /><meta property="og:description" content="(앞서 작성했던 1편에 이어 작성되었습니다.)" /><link rel="canonical" href="/posts/CollectionViewInCollectionView-2/" /><meta property="og:url" content="/posts/CollectionViewInCollectionView-2/" /><meta property="og:site_name" content="SoliOS" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-27T23:04:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CollectionView 안에 CollectionView 넣기 - (2)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="nvd2iqjDnkZKbkhCEZILzHaLouk7d4p92EArPFodwzo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-27T23:04:00+09:00","datePublished":"2022-06-27T23:04:00+09:00","description":"(앞서 작성했던 1편에 이어 작성되었습니다.)","headline":"CollectionView 안에 CollectionView 넣기 - (2)","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/CollectionViewInCollectionView-2/"},"url":"/posts/CollectionViewInCollectionView-2/"}</script><title>CollectionView 안에 CollectionView 넣기 - (2) | SoliOS</title><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://user-images.githubusercontent.com/92504186/175757408-12d2c887-5ba2-4c28-8f9c-80612bb6dbf4.JPEG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">SoliOS</a></div><div class="site-subtitle font-italic">iOS 개발자를 꿈꿉니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Hansolkkim" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hskim6521','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>CollectionView 안에 CollectionView 넣기 - (2)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>CollectionView 안에 CollectionView 넣기 - (2)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656338640" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 27, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Sol </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1560 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>(앞서 작성했던 <a href="https://hansolkkim.github.io/posts/CollectionViewInCollectionView-1">1편</a>에 이어 작성되었습니다.)</p><h2 id="4-문제-해결"><span class="mr-2">4. 문제 해결</span><a href="#4-문제-해결" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="3-issuecollectioncell의-dynamic-height"><span class="mr-2">3. IssueCollectionCell의 dynamic height</span><a href="#3-issuecollectioncell의-dynamic-height" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>하지만, Issue들 중에 Label을 가지지 않은 Issue들도 있을텐데, 이런 Issue들의 Cell의 높이는 작아져야 하지 않을까? 하는 생각에서 3번째 문제 해결을 해보고자 합니다!</p><p>현재 상황에서, Label을 가지지 않는 Cell은 다른 Cell들과 높이가 같을 뿐더러, Label이 화면 길이를 넘어가는 만큼 쌓일 경우에는 Label Cell들이 표시되지 않는 문제가 있었습니다.</p><p>첫 번째 Issue Cell은 5개의 Label Cell은 가진 경우의 모습이고, 네 번째 Issue Cell은 Label Cell을 하나도 가지지 않은 상태입니다.</p><p><img data-src="../../assets/img/SS%202022-06-27%20PM%2004.51.24.jpg" alt="SS 2022-06-27 PM 04.51.24" width="30%;" data-proofer-ignore></p><p>CollectionView에서는 TableView의 <a href="https://developer.apple.com/documentation/uikit/uitableview/1614961-automaticdimension"><code class="language-plaintext highlighter-rouge">UITableViewAutomaticDimension</code></a>과 같이, cell 안에 들어있는 컨텐츠에 맞춰서 높이를 결정해주는 기능이 없습니다.</p><p>따라서 DummyCell을 만들어서 미리 사이즈를 결정해준 뒤에, CollectionView의 sizeForItem에서 호출하는 방식이 이용됩니다.</p><p>이를 이용하기 위해서는, UICollectionViewCell의 사이즈의 결정 시점을 알아야 합니다.</p><blockquote><p>먼저, CollectionView가 그려지려고 할 때, <strong>UICollectionViewDataSource</strong>의 <code class="language-plaintext highlighter-rouge">collectionView(_:numberOfItemsInSection:)</code> 메소드가 호출되어 그려질 섹션에 몇 개의 Cell이 있는지 반환을 요청합니다.</p><p>이 때, 반환받은 값이 0이 아니라면, <strong>UICollectionViewDelegateFlowLayout</strong>에 정의되어 있는 <code class="language-plaintext highlighter-rouge">collectionView(_:layout:sizeForItemAt:)</code> 메소드가 호출되어 반환받은 값으로 CollectionViewCell의 사이즈를 결정합니다.</p><p>그리고 <strong>UICollectionViewDataSource</strong>의 <code class="language-plaintext highlighter-rouge">collectionView(_:cellForItemAt:)</code> 메소드가 호출되어 위치(indexPath)에 맞는 Cell을 반환받습니다.</p></blockquote><p><img data-src="../../assets/img/SS%202022-06-27%20PM%2004.54.37.jpg" alt="SS 2022-06-27 PM 04.54.37" width="60%;" data-proofer-ignore></p><ol><li><p>먼저, IssueCollectionCell의 Size를 정해주는 <code class="language-plaintext highlighter-rouge">collectionView(_:layout:sizeForItemAt:)</code> 메소드에서 Dummy Cell을 생성하여, 들어갈 컨텐츠의 최대 높이를 상정해 넉넉하게 Size를 잡아줍니다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> <span class="c1">// IssueCollectionViewController.swift</span>
	
 <span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span>
                     <span class="n">layout</span> <span class="nv">collectionViewLayout</span><span class="p">:</span> <span class="kt">UICollectionViewLayout</span><span class="p">,</span>
                     <span class="n">sizeForItemAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGSize</span> <span class="p">{</span>
	
     <span class="k">let</span> <span class="nv">width</span> <span class="o">=</span> <span class="kt">UIScreen</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">width</span>
     <span class="k">let</span> <span class="nv">estimatedHeight</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1">// &lt;--- 넉넉한 높이를 잡아준다.</span>
	
     <span class="k">let</span> <span class="nv">dummyCell</span> <span class="o">=</span> <span class="kt">IssueCollectionCell</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">estimatedHeight</span><span class="p">))</span>
     <span class="o">...</span>
 <span class="p">}</span>
</pre></table></code></div></div><li><p>여기서, DummyCell에, 실제로 그 위치의 Cell에 들어갈 데이터를 집어넣어 높이를 구해야 한다. 이를 위해 UICollectionViewDataSource에 있는 실제 Cell에 들어갈 데이터를 받아와야 합니다. DataSource가 나누어져있을 경우 completionHandler를 받는 아래의 메소드를 구현해주도록 합니다. (저는 실습 파일에 작성하여, Delegate, DataSource를 하나의 VC가 모두 담당하게 되어있었습니다.)</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="c1">// IssueCollectionDataSource.swift</span>
 <span class="kd">func</span> <span class="nf">referIssue</span><span class="p">(</span><span class="n">at</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">(</span><span class="kt">Issue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">let</span> <span class="nv">issue</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">item</span><span class="p">]</span>
     <span class="nf">handler</span><span class="p">(</span><span class="n">issue</span><span class="p">)</span>
 <span class="p">}</span>
</pre></table></code></div></div><p>이제 위에서 작성하던 <code class="language-plaintext highlighter-rouge">collectionView(_:layout:sizeForItemAt:)</code> 메소드에서 <code class="language-plaintext highlighter-rouge">referIssue(at:handler:)</code> 메소드를 사용하는 부분을 추가합니다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> <span class="c1">// IssueCollectionViewController.swift</span>
	
 <span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span>
                     <span class="n">layout</span> <span class="nv">collectionViewLayout</span><span class="p">:</span> <span class="kt">UICollectionViewLayout</span><span class="p">,</span>
                     <span class="n">sizeForItemAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGSize</span> <span class="p">{</span>
     <span class="o">...</span>
     <span class="n">dataSource</span><span class="o">.</span><span class="nf">referIssue</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">issue</span><span class="p">)</span> <span class="k">in</span>
         <span class="n">dummyCell</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">issue</span><span class="p">)</span>
     <span class="p">}</span>
     <span class="o">...</span>
 <span class="p">}</span>
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">referIssue(at:handler:)</code> 메소드의 handler에는 IssueCollectionCell의 <code class="language-plaintext highlighter-rouge">configure(with:)</code> 메소드를 호출하게 되는데, IssueCollectionCell은 여기서 전달받은 issue를 이용해 정확한 높이를 결정해야 합니다.</p><p>이를 위해, IssueCollectionCell(dummyCell)에서는 UI에 필요한 데이터들을 집어넣고, <code class="language-plaintext highlighter-rouge">LabelCollectionView.view.reloadData()</code> 메소드를 호출한 후, 결정된 LabelCollectionView를 dummyCell 내의 StackView에 넣어 실제 높이를 계산합니다.</p><p>또한, LabelCollectionView가 자기 크기만큼 ContentsStackView 내에 들어가도록 heightAnchor를 지정해줍니다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre> <span class="c1">// IssueCollectionCell.swift</span>
	
 <span class="kd">func</span> <span class="nf">configure</span><span class="p">(</span><span class="n">with</span> <span class="nv">issue</span><span class="p">:</span> <span class="kt">Issue</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">titleLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">issue</span><span class="o">.</span><span class="n">title</span>
     <span class="n">data</span> <span class="o">=</span> <span class="n">issue</span><span class="o">.</span><span class="n">labels</span>
     <span class="n">labelCollectionViewController</span><span class="o">.</span><span class="nf">updateLabels</span><span class="p">(</span><span class="n">issue</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
     <span class="n">labelCollectionViewController</span><span class="o">.</span><span class="nf">reloadCollectionView</span><span class="p">()</span>
     <span class="n">contentsStackView</span><span class="o">.</span><span class="nf">addArrangedSubview</span><span class="p">(</span><span class="n">labelCollectionViewController</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
	
     <span class="nf">layoutIfNeeded</span><span class="p">()</span>
     <span class="n">labelCollectionViewController</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">snp</span><span class="o">.</span><span class="n">makeConstraints</span> <span class="p">{</span> <span class="n">make</span> <span class="k">in</span>
         <span class="n">make</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="nf">equalTo</span><span class="p">(</span><span class="n">labelCollectionViewController</span><span class="o">.</span><span class="n">contentSize</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></table></code></div></div><p>여기서 <code class="language-plaintext highlighter-rouge">labelCollectionViewController.contentSize.height</code>는 아래와 같이 정의된 computed Property입니다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="c1">// LabelCollectionViewController</span>
	
 <span class="k">var</span> <span class="nv">contentSize</span><span class="p">:</span> <span class="kt">CGSize</span> <span class="p">{</span>
     <span class="k">return</span> <span class="n">labelCollectionView</span><span class="o">.</span><span class="n">contentSize</span>
 <span class="p">}</span>
</pre></table></code></div></div><li><p>이제 <code class="language-plaintext highlighter-rouge">collectionView(_:layout:sizeForItemAt:)</code> 메서드를 완성할 수 있습니다.</p><p>위에서 결정된 값들을 이용해서 EstimatedSize를 결정해줍니다. 이 때, 실제 Issue 데이터를 이용해 실제 길이가 저장된 dummy Cell을 <code class="language-plaintext highlighter-rouge">layoutIfNeeded()</code> 메서드와 <code class="language-plaintext highlighter-rouge">systemLayoutSizeFitting(_:)</code> 메서드를 사용해 딱 맞는 <strong>EstimatedSize</strong>를 결정합니다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> <span class="c1">// IssueCollectionViewController.swift</span>
	
 <span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span>
                     <span class="n">layout</span> <span class="nv">collectionViewLayout</span><span class="p">:</span> <span class="kt">UICollectionViewLayout</span><span class="p">,</span>
                     <span class="n">sizeForItemAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGSize</span> <span class="p">{</span>
     <span class="o">...</span>
     <span class="n">dummyCell</span><span class="o">.</span><span class="nf">layoutIfNeeded</span><span class="p">()</span>
	
     <span class="k">let</span> <span class="nv">estimatedSize</span> <span class="o">=</span> <span class="n">dummyCell</span><span class="o">.</span><span class="nf">systemLayoutSizeFitting</span><span class="p">(</span><span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">estimatedHeight</span><span class="p">))</span>
	
     <span class="k">return</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">estimatedSize</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
 <span class="p">}</span>
</pre></table></code></div></div></ol><p>위의 과정을 모두 거쳐 아래와 같은 화면을 <strong>드디어</strong> 볼 수 있었습니다!</p><p><img data-src="../../assets/img/SS%202022-06-27%20PM%2010.37.13.jpg" alt="SS 2022-06-27 PM 10.37.13" width="40%;" data-proofer-ignore></p><h3 id="4-uilabel의-rounded-style"><span class="mr-2">4. UILabel의 rounded style</span><a href="#4-uilabel의-rounded-style" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>다른 프로젝트들을 하면서 궁금했던 점이었는데, 이번 포스팅을 작성하면서 해결한 방법이 있어 문제 해결로 작성합니다!</p><p>기존에는, Cell의 Height가 얼마나 될지 예상하여 <code class="language-plaintext highlighter-rouge">UILabel.layer.cornerRadius</code>를 결정해줬습니다.</p><p>이번에는 LabelCollectionCell의 Height가 EstimatedSize로 인해 결정되기 때문에 UI가 그려질 때 그에 맞는 높이에 의해 <code class="language-plaintext highlighter-rouge">cornerRadius</code>가 결정되도록 하려 했습니다.</p><p>위의 방법을 구현하기 위해 작성한 코드는 아래와 같습니다.</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">// LabelCollectionCell.swift</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="kt">LabelCollectionCell</span><span class="p">:</span> <span class="kt">UICollectionViewCell</span> <span class="p">{</span>
    <span class="o">...</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">layoutSubviews</span><span class="p">()</span>
        <span class="n">labelLabel</span><span class="o">.</span><span class="n">snp</span><span class="o">.</span><span class="n">makeConstraints</span> <span class="p">{</span> <span class="n">make</span> <span class="k">in</span>
            <span class="n">make</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">leading</span><span class="o">.</span><span class="nf">equalTo</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">labelLabel</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">cornerRadius</span> <span class="o">=</span> <span class="n">labelLabel</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">layoutSubviews()</code> 메서드는 레이아웃 정보 변경 사항이 뷰에 반영될 때 호출되는데, 이 메서드는 재귀적으로 모든 자식 뷰의 <code class="language-plaintext highlighter-rouge">layoutSubviews()</code> 메서드를 호출합니다.(따라서 실행될 시에 부하가 매우 큰 메서드임.)</p><p>IssueCollectionCell에서 <code class="language-plaintext highlighter-rouge">layoutIfNeeds()</code> 메소드가 호출되면</p><p><code class="language-plaintext highlighter-rouge">layoutSubviews()</code> 가 호출되고,</p><p>이로 인해 하위 뷰인 LabelCollectionCell의 <code class="language-plaintext highlighter-rouge">layoutSubviews()</code> 또한 호출될 것입니다.</p><p>또한, 이 시점에는 LabelCollectionCell의 Layout들이 모두 잡혀있는 상황이기 때문에, labelLabel의 높이 또한 잡혀있게 됩니다.</p><p>이 시점에 해당 UILabel의 <code class="language-plaintext highlighter-rouge">layer.cornerRadius</code>를 설정해줌으로써 원하는 시점에서 둥근 모양의 Label을 만들 수 있었습니다.</p><hr /><ul><li><a href="https://gist.github.com/Hansolkkim/e2d7f286d26d5c33ea4cca1951774914">코드 내용은 여기에</a></ul><h2 id="5-참고-자료"><span class="mr-2">5. 참고 자료</span><a href="#5-참고-자료" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><p><a href="https://corykim0829.github.io/ios/UICollectionViewCell-dynamic-height/#">[ColectionViewCell Dynamic Height]</a></p><li><p><a href="https://stackoverflow.com/questions/39799520/set-rounded-corners-on-uiimage-in-uicollectionviewcell-in-swift">[StackOverflow-Set rounded corner on UIImage in UICollectionViewCell in swift]</a></p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios/'>iOS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >iOS</a> <a href="/tags/collectionview/" class="post-tag no-text-decoration" >CollectionView</a> <a href="/tags/dynamic/" class="post-tag no-text-decoration" >dynamic</a> <a href="/tags/roundedlabel/" class="post-tag no-text-decoration" >roundedLabel</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CollectionView+%EC%95%88%EC%97%90+CollectionView+%EB%84%A3%EA%B8%B0+-+%282%29+-+SoliOS&url=%2Fposts%2FCollectionViewInCollectionView-2%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CollectionView+%EC%95%88%EC%97%90+CollectionView+%EB%84%A3%EA%B8%B0+-+%282%29+-+SoliOS&u=%2Fposts%2FCollectionViewInCollectionView-2%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FCollectionViewInCollectionView-2%2F&text=CollectionView+%EC%95%88%EC%97%90+CollectionView+%EB%84%A3%EA%B8%B0+-+%282%29+-+SoliOS" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="Hansolkkim/Hansolkkim.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Coordinator/">Coordinator Pattern</a><li><a href="/posts/CGAffineTransform/">CGAffineTransform에 대해</a><li><a href="/posts/CollectionViewInCollectionView-1/">CollectionView 안에 CollectionView 넣기 - (1)</a><li><a href="/posts/ViewLayout/">iOS의 Layout</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/collectionview/">CollectionView</a> <a class="post-tag" href="/tags/dynamic/">dynamic</a> <a class="post-tag" href="/tags/cgaffinetransform/">CGAffineTransform</a> <a class="post-tag" href="/tags/coordinator-pattern/">Coordinator Pattern</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/layout/">Layout</a> <a class="post-tag" href="/tags/roundedlabel/">roundedLabel</a> <a class="post-tag" href="/tags/string-size/">String.size</a> <a class="post-tag" href="/tags/uicollectionview/">UICollectionView</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CollectionViewInCollectionView-1/"><div class="card-body"> <em class="small" data-ts="1656333480" data-df="ll" > Jun 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CollectionView 안에 CollectionView 넣기 - (1)</h3><div class="text-muted small"><p> 1. 계기 코드스쿼드 마지막 팀 프로젝트인 Issue Tracker를 진행하다가, CollectionView(Issue Cell)안에 CollectionView(Label Cell)이 있으면 편하게 구현할 수 있겠다고 생각했습니다. 하지만 편할 것이라는 생각과는 다르게, 처음 해보다보니 이 두 CollectionVIew의 DataSource를 관리...</p></div></div></a></div><div class="card"> <a href="/posts/ViewLayout/"><div class="card-body"> <em class="small" data-ts="1656592980" data-df="ll" > Jun 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>iOS의 Layout</h3><div class="text-muted small"><p> 계기 UITableView는 Cell의 Subview들의 Constraints만 잘 잡아주면 Cell의 높이가 동적으로 설정되는 기능을 이용하려 했습니다. 그런데 아무리해도 Cell의 높이는 45 point로 그대로였고, 이거 떄문에 2시간동안 Constraints만 엄청 수정했습니다.. 포기하고 자려고 하다가, 자기 직전에 요즘 버릇인 UIVi...</p></div></div></a></div><div class="card"> <a href="/posts/Coordinator/"><div class="card-body"> <em class="small" data-ts="1658713390" data-df="ll" > Jul 25, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Coordinator Pattern</h3><div class="text-muted small"><p> 계기 토이 프로젝트를 진행하면서, 보다 가벼운 ViewController를 만들 필요성을 느껴 Coordinator Pattern을 적용해보고, 이를 정리하기 위해 포스팅을 작성합니다. Coordinator Pattern? Coordinator Pattern은 Soroush Khanlou가 2015년에 The Coordinator라는 글을 쓰...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CollectionViewInCollectionView-1/" class="btn btn-outline-primary" prompt="Older"><p>CollectionView 안에 CollectionView 넣기 - (1)</p></a> <a href="/posts/ViewLayout/" class="btn btn-outline-primary" prompt="Newer"><p>iOS의 Layout</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="">Sol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/collectionview/">CollectionView</a> <a class="post-tag" href="/tags/dynamic/">dynamic</a> <a class="post-tag" href="/tags/cgaffinetransform/">CGAffineTransform</a> <a class="post-tag" href="/tags/coordinator-pattern/">Coordinator Pattern</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/layout/">Layout</a> <a class="post-tag" href="/tags/roundedlabel/">roundedLabel</a> <a class="post-tag" href="/tags/string-size/">String.size</a> <a class="post-tag" href="/tags/uicollectionview/">UICollectionView</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
